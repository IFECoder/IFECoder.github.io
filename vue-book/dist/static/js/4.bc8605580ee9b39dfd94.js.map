{"version":3,"sources":["webpack:///src/components/List.vue","webpack:///./src/components/List.vue?b27e","webpack:///./src/components/List.vue"],"names":["List","data","books","offset","hasMore","isLoading","mounted","_this","this","scroll","$refs","top","offsetTop","distance","isMove","addEventListener","e","scrollTop","start","touches","pageY","move","current","style","removeEventListener","end","clearInterval","timer1","setInterval","getBook","created","methods","addCart","book","$store","commit","mutations_type","loadMore","_this2","clearTimeout","timer","setTimeout","_$refs$scroll","clientHeight","scrollHeight","more","removeData","id","_this3","asyncToGenerator_default","regenerator_default","a","mark","_callee","wrap","_context","prev","next","Object","api","filter","item","bookId","stop","_this4","_callee2","_ref","_context2","sent","concat","toConsumableArray_default","length","computed","components","MHeader","components_List","render","_vm","_h","$createElement","_c","_self","_v","ref","staticClass","on","_l","index","key","attrs","to","name","params","bid","tag","directives","rawName","value","expression","_s","bookName","bookInfo","bookPrice","click","$event","stopPropagation","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/4.bc8605580ee9b39dfd94.js","sourcesContent":["<template>\r\n    <div>\r\n    \t<MHeader>列表页</MHeader>\r\n        <div class=\"content\" ref=\"scroll\" @scroll=\"loadMore\">\r\n            <ul>\r\n                <router-link v-for='(book,index) in books' :to='{name:\"detail\",params:{bid:book.bookId}}' :key='index' tag='li'>\r\n                    <img v-lazy=\"book.bookCover\">\r\n                    <div>\r\n                        <h4>{{book.bookName}}</h4>\r\n                        <p>{{book.bookInfo}}</p>\r\n                        <b>￥{{book.bookPrice}}</b>\r\n                        <div class=\"btn-list\">\r\n                          <button @click.stop=\"removeData(book.bookId)\">删除</button>\r\n                          <button @click.stop=\"addCart(book)\">添加</button>\r\n                        </div>\r\n                    </div>\r\n                </router-link>\r\n            </ul>\r\n            <div @click=\"more\" class=\"more\">加载更多</div>\r\n        </div>\r\n    </div>\r\n</template>\r\n<!-- 循环组件要加一个key，防止报警告信息-->\r\n<script>\r\n    import MHeader from '../base/MHeader.vue'\r\n    import {removeBook,pagenation} from '../api/index.js'\r\n    import * as Types from '../store/mutations-type.js'\r\n    export default{\r\n    \tdata(){\r\n    \t\treturn {books:[],offset:0,hasMore:true,isLoading:false}\r\n    \t},\r\n      mounted(){\r\n        let scroll = this.$refs.scroll; //获取到要拖拽的元素\r\n        let top = scroll.offsetTop;\r\n        let distance = 0;\r\n        let isMove = false;\r\n        scroll.addEventListener('touchstart',(e)=> {\r\n            // 滚动条在最顶端时 并且当前盒子在顶端时候 才继续走\r\n            if(scroll.scrollTop !=0 || scroll.offsetTop != top) return\r\n              let start = e.touches[0].pageY; //手指点击的开始\r\n              let move = (e)=>{\r\n                isMove = true;\r\n                let current = e.touches[0].pageY;\r\n                distance = current - start; //求的拉动的距离 负的就不要了\r\n                if(distance>0){ // 如果大于50了 认为就是50像素\r\n                  if(distance<=50){\r\n                    scroll.style.top = distance + top +'px';\r\n                  }else{\r\n                    distance = 50;\r\n                    scroll.style.top = top+50+'px';\r\n                  }\r\n                }else{\r\n                  // 如果不在考虑范围内 移除掉move和end事件\r\n                  scroll.removeEventListener('touchmove',move);\r\n                  scroll.removeEventListener('touchend',end);\r\n                }\r\n              };\r\n              let end = (e)=>{\r\n                if(!isMove)return;\r\n                isMove = false;\r\n                clearInterval(this.timer1);\r\n                this.timer1 = setInterval(()=>{ // 一共distance 每次-1\r\n                  if(distance<=0){\r\n                    clearInterval(this.timer1);\r\n                    distance = 0;\r\n                    scroll.style.top = top+'px';\r\n                    scroll.removeEventListener('touchmove',move);\r\n                    scroll.removeEventListener('touchend',end);\r\n                    this.books = []; // 先清空数据\r\n                    this.offset = 0;\r\n                    this.hasMore = true;\r\n                    this.getBook();\r\n                    return\r\n                  }\r\n                  distance -=1;\r\n                  scroll.style.top =top + distance+'px';\r\n                },1);\r\n              };\r\n              scroll.addEventListener('touchmove',move);\r\n              scroll.addEventListener('touchend',end);\r\n        },false);\r\n      },\r\n      created(){\r\n           this.getBook();\r\n      },\r\n    \tmethods:{\r\n            addCart(book){\r\n               this.$store.commit(Types.ADD_CART,book)\r\n            },\r\n            loadMore(){\r\n                // 卷去的高度   当前可见区域  总高\r\n              // 触发scroll事件 可能触发n次  先进来开一个定时器，下次触发时将上一次定时器清除掉\r\n              clearTimeout(this.timer); // 节流\r\n              this.timer = setTimeout(()=>{\r\n                let {scrollTop,clientHeight,scrollHeight} = this.$refs.scroll;\r\n                if(scrollTop+clientHeight+20>scrollHeight){\r\n                    this.getBook(); // 获取更多（上拉刷新获取更多）\r\n                }\r\n              },60);\r\n            },\r\n            more(){\r\n              this.getBook()\r\n            },\r\n            async removeData(id){\r\n                await removeBook(id);\r\n                this.books = this.books.filter(item=>item.bookId !== id);\r\n            },\r\n            async getBook(){\r\n                if(this.hasMore&&!this.isLoading){\r\n                  let {hasMore,books} = await pagenation(this.offset);\r\n                  this.books=[...this.books,...books];\r\n                  this.hasMore=hasMore;\r\n                  this.isLoading = false; // 加载完毕\r\n                  this.offset = this.books.length;\r\n                }\r\n            }\r\n        },\r\n    \tcomputed:{},\r\n    \tcomponents:{MHeader}\r\n    }\r\n</script>\r\n<style scoped>\r\n  .content ul{\r\n    padding: 10px;\r\n  }\r\n  .content ul li{\r\n    display: flex;\r\n    padding: 10px 0;\r\n    border-bottom: 1px solid #f1f1f1;\r\n  }\r\n  .content ul li img{\r\n    width:130px;\r\n    height: 150px;\r\n  }\r\n  .content h4{\r\n    font-size: 20px;\r\n    line-height: 35px;\r\n  }\r\n  .content p{\r\n    color: #2a2a2a;\r\n    line-height: 25px;\r\n  }\r\n  .content b {\r\n    color: red;\r\n  }\r\n  .content button{\r\n    display: block;width: 60px;height: 25px; background: orangered; color: #fff;border: none; border-radius: 15px; outline: none;\r\n  }\r\n  .more{\r\n    margin: 10px;\r\n    background: #2afedd;\r\n    height: 30px;\r\n    line-height: 30px;\r\n    text-align: center;\r\n    font-size: 20px;\r\n  }\r\n  .btn-list{\r\n    display: flex;\r\n    justify-content: space-around;\r\n  }\r\n  ul div{\r\n    width:189px;\r\n    height: 150px;\r\n  }\r\n</style>\r\n<!-- 图片懒加载（插件使用的流程） -->\r\n<!--  \r\n    1.导入插件（入口main.js）\r\n    2.使用一下插件（入口main.js）\r\n    3.在需要用到懒加载的组件里面，将之前的src替换为v-lazy（插件list.vue）\r\n -->\r\n\r\n\r\n<!-- 发布项目（流程） -->\r\n<!--  \r\n    1.代码分割\r\n -->\n\n\n// WEBPACK FOOTER //\n// src/components/List.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('MHeader',[_vm._v(\"列表页\")]),_vm._v(\" \"),_c('div',{ref:\"scroll\",staticClass:\"content\",on:{\"scroll\":_vm.loadMore}},[_c('ul',_vm._l((_vm.books),function(book,index){return _c('router-link',{key:index,attrs:{\"to\":{name:\"detail\",params:{bid:book.bookId}},\"tag\":\"li\"}},[_c('img',{directives:[{name:\"lazy\",rawName:\"v-lazy\",value:(book.bookCover),expression:\"book.bookCover\"}]}),_vm._v(\" \"),_c('div',[_c('h4',[_vm._v(_vm._s(book.bookName))]),_vm._v(\" \"),_c('p',[_vm._v(_vm._s(book.bookInfo))]),_vm._v(\" \"),_c('b',[_vm._v(\"￥\"+_vm._s(book.bookPrice))]),_vm._v(\" \"),_c('div',{staticClass:\"btn-list\"},[_c('button',{on:{\"click\":function($event){$event.stopPropagation();_vm.removeData(book.bookId)}}},[_vm._v(\"删除\")]),_vm._v(\" \"),_c('button',{on:{\"click\":function($event){$event.stopPropagation();_vm.addCart(book)}}},[_vm._v(\"添加\")])])])])})),_vm._v(\" \"),_c('div',{staticClass:\"more\",on:{\"click\":_vm.more}},[_vm._v(\"加载更多\")])])],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-a7c7e180\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/List.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-a7c7e180\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./List.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./List.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./List.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-a7c7e180\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./List.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-a7c7e180\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/List.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}